version: "3.8"

services:
  ner-service:
    image: ner-service:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ner-service
    ports:
      - "8081:8081"
    volumes:
      # Mount downloaded models as read-only volume
      # Models should be downloaded using: python download_all_models.py --output-dir ./models
      - ./models:/app/models:ro
    environment:
      # Framework selection: spacy, stanza, or both (default)
      - NER_FRAMEWORK=both
      # Model paths - should match volume mount points
      - SPACY_MODEL_PATH=/app/models/spacy
      - STANZA_MODEL_PATH=/app/models/stanza
      # Fallback mode for unsupported languages
      - NER_FALLBACK_MODE=multilingual
      # Python settings
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    # Resource limits (adjust based on your hardware)
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 4G
        reservations:
          cpus: "1"
          memory: 2G
