# Development environment values for SentinelTranslate
# Override default values for local/development deployments

global:
  imagePullPolicy: Always
  # ECR registry will be set dynamically at deployment time via Makefile
  # Format: <account-id>.dkr.ecr.<region>.amazonaws.com
  ecrRegistry: "SET_AT_DEPLOYMENT"

# Use smaller Redis for development
redis:
  enabled: true

  # Use AWS Public ECR to avoid Docker Hub rate limiting
  image:
    registry: public.ecr.aws
    repository: bitnami/redis
    tag: 7.2.4-debian-12-r9

  master:
    persistence:
      enabled: false  # Disable persistence for faster startup
      size: 1Gi
    resources:
      requests:
        memory: "128Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "250m"

  metrics:
    enabled: true
    image:
      registry: public.ecr.aws
      repository: bitnami/redis-exporter
      tag: 1.58.0-debian-12-r4

# Disable Triton for CPU-only dev environment
# (Triton requires GPU which isn't available on t3.medium nodes)
triton:
  enabled: false
  replicaCount: 1

  # Use ECR image with embedded models
  image:
    repository: sentineltranslate-triton
    tag: dev
    pullPolicy: Always

  # CPU-only resources for dev environment (no GPU)
  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

  # Disable GPU node selector for CPU-only dev environment
  nodeSelector: null

  # Disable GPU tolerations for dev
  tolerations: []

  # Use emptyDir for models (mount models from local)
  persistence:
    enabled: false

# Single replica for development
sidecar:
  enabled: true
  replicaCount: 1

  image:
    repository: sentineltranslate-sidecar
    tag: dev
    pullPolicy: Always

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

  autoscaling:
    enabled: false

api:
  enabled: true
  replicaCount: 1

  image:
    repository: sentineltranslate-api
    tag: dev
    pullPolicy: Always

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  serviceAccount:
    create: true
    annotations: {}
      # For local development, may not need IRSA

  env:
    AWS_REGION: "us-east-1"

  autoscaling:
    enabled: false

worker:
  enabled: true
  replicaCount: 1

  image:
    repository: sentineltranslate-worker
    tag: dev
    pullPolicy: Always

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  celery:
    concurrency: 2
    logLevel: DEBUG
    maxTasksPerChild: 100

  serviceAccount:
    create: true
    annotations: {}

  autoscaling:
    enabled: false

# Disable ingress for development (use port-forward instead)
ingress:
  enabled: false

# Disable monitoring in dev
serviceMonitor:
  enabled: false

# Relaxed security for development
securityContext:
  runAsNonRoot: false
  runAsUser: 0
  fsGroup: 0

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL
